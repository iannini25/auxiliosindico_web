<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Cadastro ‚Äî Jos√© Lopes</title>

  <!-- estilos globais do projeto -->
  <link rel="stylesheet" href="assets/css/style.css" />

  <!-- recomenda√ß√µes de iOS safe area e cor do tema -->
  <meta name="theme-color" content="#141822" />
</head>

<body class="page" data-page="signup">
  <main class="app app--center" role="main">
    <header class="app__header" style="margin-bottom: 1rem;">
      <h1 class="brand__title">Criar conta</h1>
      <p class="brand__subtitle">Acesse o app do pr√©dio</p>
    </header>

    <section class="panel" style="max-width: var(--maxw); width: 100%;">
      <form id="signup-form" class="form grid" style="display: grid; gap: 12px;">
        <div class="field">
          <label for="name" class="label">Nome</label>
          <input id="name" class="input" autocomplete="name" required />
        </div>

        <div class="field">
          <label for="phone" class="label">Telefone</label>
          <input id="phone" class="input" inputmode="tel" autocomplete="tel" placeholder="(31) 9XXXX-XXXX" required />
        </div>

        <div class="field">
          <label for="apt" class="label">Apartamento</label>
          <input id="apt" class="input" type="number" inputmode="numeric" placeholder="Ex: 604" required />
        </div>

        <div class="field">
          <label for="email" class="label">Email</label>
          <input id="email" class="input" type="email" autocomplete="email" placeholder="voce@email.com" required />
        </div>

        <button class="btn btn--primary" type="submit">Cadastrar</button>

        <p class="hint" style="color: var(--muted); margin: .25rem 0 0;">
          Senha inicial = <strong>n√∫mero do apartamento</strong>
          
        </p>


        <p id="form-error" class="alert" style="display:none; margin-top:.5rem;"></p>
      </form>
    </section>

    <p style="margin-top: 1rem;">
      <a class="link" href="login.html">J√° tenho conta</a>
    </p>
  </main>

  <!-- Caminho corrigido -->
  <script type="module">
    import { signUp, isValidApartment } from "./assets/js/core/auth.js";

    const form = document.getElementById("signup-form");
    const errBox = document.getElementById("form-error");
    const phoneInput = document.getElementById("phone");

    function showError(msg) {
      errBox.textContent = msg;
      errBox.style.display = "block";
    }

    function clearError() {
      errBox.textContent = "";
      errBox.style.display = "none";
    }

    // üîí Limite e m√°scara de telefone (apenas n√∫meros, m√°x 11 d√≠gitos)
    phoneInput.addEventListener("input", () => {
      // remove tudo que n√£o for n√∫mero
      let digits = phoneInput.value.replace(/\D/g, "");
      // limita a 11 caracteres
      if (digits.length > 11) digits = digits.slice(0, 11);
      // aplica m√°scara simples (XX) XXXXX-XXXX
      if (digits.length <= 2) {
        phoneInput.value = digits;
      } else if (digits.length <= 7) {
        phoneInput.value = `(${digits.slice(0, 2)}) ${digits.slice(2)}`;
      } else {
        phoneInput.value = `(${digits.slice(0, 2)}) ${digits.slice(2, 7)}-${digits.slice(7)}`;
      }
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearError();

      const name = document.getElementById("name").value.trim();
      const phone = phoneInput.value.replace(/\D/g, ""); // s√≥ n√∫meros
      const email = document.getElementById("email").value.trim();
      const apt = Number(document.getElementById("apt").value);

      if (phone.length !== 11) {
        showError("Telefone inv√°lido. Digite no formato DDD + n√∫mero (11 d√≠gitos).");
        return;
      }

      if (!isValidApartment(apt)) {
        showError("Apartamento inv√°lido. Use algo entre 201‚Äì204, 301‚Äì304, ‚Ä¶, 601‚Äì604.");
        return;
      }

      try {
        await signUp({ name, phone, apt, email });
        window.location.href = "./index.html";
      } catch (err) {
        showError(err?.message || "N√£o foi poss√≠vel cadastrar. Tente novamente.");
      }
    });

    document.getElementById("name").focus({ preventScroll: true });
  </script>

</body>

</html>


